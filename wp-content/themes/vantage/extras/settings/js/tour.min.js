
jQuery(function($){var
tourSetting,tourSettingPlaceholder,tourVideo,tourIndex=0,tourModal=null;var tourLink=$('<div id="start-theme-tour" class="screen-meta-toggle"><a href="#">'+siteoriginSettings.tour.buttonText+'</a></div>').click(function(){startSettingsTour();});$('#screen-meta-links').append(tourLink);var refreshTourFrame=function(){endTourFrame();var stepContent=siteoriginSettings.tour.content[tourIndex];tourModal.find('.step-title').html(stepContent.title);tourModal.find('.step-content').html(stepContent.content);if(typeof stepContent.image!='undefined'){tourModal.find('.step-image').attr('src',stepContent.image).show();}
else{tourModal.find('.step-image').hide();}
if(typeof stepContent.video!='undefined'){tourVideo=stepContent.video;tourModal.find('.play-video').show();}
else{tourModal.find('.play-video').hide();}
if(typeof stepContent.action!='undefined'){tourModal.find('.siteorigin-settings-tour-action').attr('href',stepContent.action.href.split('&amp;').join('&')).html(stepContent.action.text).show();}
else{tourModal.find('.siteorigin-settings-tour-action').hide();}
if(typeof stepContent.setting!='undefined'){tourSetting=$('#siteorigin-settings-form div[data-field="'+stepContent.setting+'"]').closest('tr');tourSettingPlaceholder=tourSetting.clone();tourSetting.after(tourSettingPlaceholder);tourSettingPlaceholder.find('select').val(tourSetting.find('select').val());tourSetting.find('input, select, textarea').change(function(){var newTourSettingPlaceholder=tourSetting.clone();tourSettingPlaceholder.after(newTourSettingPlaceholder);tourSettingPlaceholder.remove();tourSettingPlaceholder=newTourSettingPlaceholder;tourSettingPlaceholder.find('select').val(tourSetting.find('select').val());});tourModal.find('.siteorigin-settings-form tbody').append(tourSetting);tourModal.find('.siteorigin-settings-form').show();tourModal.find('.siteorigin-settings-preview').show();}
else{tourModal.find('.siteorigin-settings-form').hide();tourModal.find('.siteorigin-settings-preview').hide();}
if(tourIndex<=0){tourModal.find('.tour-previous').hide();}
else{tourModal.find('.tour-previous').show();}
var nextButtonText=tourModal.find('.settings-form-buttons .tour-next span');nextButtonText.html(tourIndex==siteoriginSettings.tour.content.length-1?nextButtonText.data('text-done'):nextButtonText.data('text-continue'));var toolbar=tourModal.find('#settings-tour-toolbar');toolbar.find('.step').html(tourIndex+1);toolbar.find('.step-total').html(siteoriginSettings.tour.content.length);}
var endTourFrame=function(){if(tourSetting!=null&&tourSettingPlaceholder!=null){tourSetting.find('input, select, textarea').unbind('change');tourSettingPlaceholder.after(tourSetting).remove();tourSetting=null;tourSettingPlaceholder=null;}}
var startSettingsTour=function(){tourIndex=0;if(tourModal!=null){tourModal.show();refreshTourFrame();return;}
for(var i=0;i<siteoriginSettings.tour.content.length;i++){if(typeof siteoriginSettings.tour.content[i].image!='undefined'){console.log('Preload '+siteoriginSettings.tour.content[i].image);$('<img/>')[0].src=siteoriginSettings.tour.content[i].image;}}
var template=$('#settings-tour-modal-template').html();tourModal=$(template).appendTo('body');tourModal.find('.siteorigin-settings-preview').click(function(){$('#siteorigin-settings-form .siteorigin-settings-preview-button').click();});tourModal.find('.siteorigin-settings-save').click(function(){$('#siteorigin-settings-form .siteorigin-settings-submit-button').click();});tourModal.find('.play-video').click(function(e){e.preventDefault();window.open('https://player.vimeo.com/video/'+tourVideo+'?title=0&byline=0&portrait=0&autoplay=1','videowindow','width=640,height=362,resizeable,scrollbars');});tourModal.find('.tour-next').click(function(e){e.preventDefault();if(tourIndex>=siteoriginSettings.tour.content.length-1){tourIndex=0;endTourFrame();tourModal.hide();}
else{tourIndex++;refreshTourFrame();}
return false;});tourModal.find('.tour-previous').click(function(e){e.preventDefault();if(tourIndex>0){tourIndex--;refreshTourFrame();}
return false;});tourModal.find('#settings-tour-overlay, .siteorigin-settings-close').click(function(e){e.preventDefault();endTourFrame();tourModal.hide();tourIndex=0;});refreshTourFrame();};if(window.location.hash=='#tour'){startSettingsTour();}});